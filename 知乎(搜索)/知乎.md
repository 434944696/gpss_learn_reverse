# 知乎(搜索)

探索一下知乎的搜索接口，

输入关键字 **人可以节俭到什么程度**点击搜索

![image-20230721152932231](./知乎.assets/image-20230721152932231.png)

查看一下数据

## 接口分析

点击刷新按钮，进行抓包。

![image-20230721153111037](./知乎.assets/image-20230721153111037.png)

搜索**一个大学生**关键字快速定位接口位置。

api/v4/search_v3 接口为搜索接口

查看请求参数，

![image-20230721153304687](./知乎.assets/image-20230721153304687.png)

没有密文，

![image-20230721153426626](./知乎.assets/image-20230721153426626.png)

cookie有一大片，

![image-20230721153446727](./知乎.assets/image-20230721153446727-1689924887204-1.png)

headers也是一大片，

复制curl连接模拟一下，去除一下参数吧，这么多肯定不能都有效。

![image-20230721153559420](./知乎.assets/image-20230721153559420.png)

经过测试

cookies的 **d_c0**

headers的 **x-zse-93 x-zse-96  x-zst-81**

 在搜一个别的关键字，验证一下这个判断是否正确。

![image-20230721153924496](./知乎.assets/image-20230721153924496.png)

验证了一下没问题，就是这4个参数。

ok逆向开始

## 逆向分析

一个一个来 先搞 cookies的d_c0

### cookie中的d_c0

搜索debugger了半天，hook也试了

定位不到，最后发现在这个请求里set进来的。

。。。。

![image-20230721160238737](./知乎.assets/image-20230721160238737.png)

试一下这个udid是不能模拟随便拿。

![image-20230721161045520](./知乎.assets/image-20230721161045520.png)

测试一下可以返回。

然后看headers里面的参数

### headers中的x-zse-96

因为 93 开起来像一个版本，大概率是死的，先看加密的

全局搜索  x-zse-96 

![image-20230721164738637](./知乎.assets/image-20230721164738637.png)

这里搜索到了直接断点住，

刷新页面继续看

![image-20230721165708838](./知乎.assets/image-20230721165708838.png)

这里看得出来， tT是加密结果，

它是由 tE.source得出，

tE由 et方法得出 参数是 te，tl.body， {zse93，dc0，xZst81} tv

4个参数

把断点上移，

![image-20230721170122366](./知乎.assets/image-20230721170122366.png)

到函数开的地方，刷新再看一下

逐个分析参数吧：

te 为接口名称

![image-20230721170314097](./知乎.assets/image-20230721170314097.png)

tl.body 是undefined

![image-20230721170335465](./知乎.assets/image-20230721170335465.png)

**ty 是 '101_3_3.0' 也就是我们上面需要的 x-zse-93**

![image-20230721170447699](./知乎.assets/image-20230721170447699.png)

tS 是 headers中的 d_c0 我们从udid接口中获得的

![image-20230721170501610](./知乎.assets/image-20230721170501610.png)

t_ 是 t_ = tf.xZst81 || td.get("x-zst-81") 在 td中获取到的

这里看 t_是null

 ![image-20230721170837454](./知乎.assets/image-20230721170837454.png)

但是我们知道 t_就是 我们要找的 x-zse-81，

是null的原因，因该是因为接口问题 我们要找的接口是

/api/v4/search_v3

断点到 /api/v4/search_v3再看看呢

![image-20230721171305145](./知乎.assets/image-20230721171305145.png)

en

![image-20230721172732887](./知乎.assets/image-20230721172732887.png)

debug到search_v3发现81还是null

![image-20230721172812544](./知乎.assets/image-20230721172812544.png)

确实是没有，难道81不需要？

先把96搞下来吧

96主要是由

![image-20230721173041882](./知乎.assets/image-20230721173041882.png)

ef生成的把ef扣下来，补一下参数试一试吧

![image-20230721173513000](./知乎.assets/image-20230721173513000.png)

没有t5函数补一下。

![image-20230721173604475](./知乎.assets/image-20230721173604475.png)

补完t5缺t3