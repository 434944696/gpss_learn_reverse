# 看准网

> 网站地址： aHR0cHM6Ly93d3cua2Fuemh1bi5jb20vZmlybS9pbnRlcnZpZXcvMW5SLTI5OH4uaHRtbD9rYT1jb20taW50ZXJ2aWV3LW1vZHVsZS1leHBvc2U=
>
> https://github.com/Guapisansan/gpss_learn_reverse 代码在这里，会持续更新逆向案例

**免责声明： 此文档，以及脚本，仅用来对技术的学习与探讨，如有冒犯，请联系作者电话，微信13933566015进行删除**

## 

![image-20230807142951893](./看准网.assets/image-20230807142951893.png)

看一下这部分数据

![image-20230807143038916](./看准网.assets/image-20230807143038916.png)

只能看一小部分数据，其他的要登陆才可以看到。

## 流程分析

先抓个包看看吧

直接选择搜索关键字

![image-20230807143204353](./看准网.assets/image-20230807143204353.png)

发现可以搜到看一下



![image-20230807143251532](./看准网.assets/image-20230807143251532.png)

这个里面有，难道这么简单吗

试着请求一下吧

![image-20230807144611681](./看准网.assets/image-20230807144611681.png)

这么看好像还真有，解析一下吧

这个对象再页面上长这个样子

![image-20230807144935033](./看准网.assets/image-20230807144935033.png)

正则提取一些吧

嗯我尝试用re解析但好像不太准确

![image-20230807145506103](./看准网.assets/image-20230807145506103.png)

换一条路，这些数据肯定也会来自请求

![image-20230807145540089](./看准网.assets/image-20230807145540089.png)

这个请求的密文感觉就是数据。

解密看看呗

## 逆向分析

### 解密响应

![image-20230807145924660](./看准网.assets/image-20230807145924660.png)

xhr接口断断点，刷新页面，往前跟栈

![image-20230807150204912](./看准网.assets/image-20230807150204912.png)

跟栈来到他异步加载的地方看一下，这个地方经常藏有加密

![image-20230807150429696](./看准网.assets/image-20230807150429696.png)

进去把着5个方法都看看，将可疑的地方下断点

![image-20230807150624071](./看准网.assets/image-20230807150624071.png)

![image-20230807150643833](./看准网.assets/image-20230807150643833.png)



![image-20230807150554824](./看准网.assets/image-20230807150554824.png)

![image-20230807150724265](./看准网.assets/image-20230807150724265.png)

![image-20230807150756912](./看准网.assets/image-20230807150756912.png)

将可疑的地方下断点，刷新页面触发断点。

第三个可疑地方

![image-20230807150921423](./看准网.assets/image-20230807150921423.png)

感觉不是，继续下一步

![image-20230807151025534](./看准网.assets/image-20230807151025534.png)

这个第四个方法就是解密地方，这里有加密数据，

![image-20230807151119331](./看准网.assets/image-20230807151119331.png)

经过测试这个M.gy就是解密函数

搞他,跟进去

![image-20230807151344164](./看准网.assets/image-20230807151344164.png)

![image-20230807151406502](./看准网.assets/image-20230807151406502.png)

这个就是一个AES

其实在上面看到 iv  就大概知道了

实现一下解密

值得注意的是

这个 n.key

![image-20230807153727203](./看准网.assets/image-20230807153727203.png)

看一下实现结果：

![image-20230807153806522](./看准网.assets/image-20230807153806522.png)

发现这个接口解出来的东西是这个

![image-20230807155007691](./看准网.assets/image-20230807155007691.png)

发现了，并不是所有接口都能解密成功，

发现了个坑

![image-20230807155943929](./看准网.assets/image-20230807155943929.png)

这次请求是成功的

![image-20230807160000474](./看准网.assets/image-20230807160000474.png)

我将这个复制到e

![image-20230807160021254](./看准网.assets/image-20230807160021254.png)

说明他对data进行处理了

我们进行一下文本比较

![image-20230807160431422](./看准网.assets/image-20230807160431422.png)

发现两个字符不一样长

因该是处理过的了

找一下他处理的逻辑吧

对比下来，只是我复制的有空格，

这是个坑

![image-20230807161911826](./看准网.assets/image-20230807161911826.png)

![image-20230807161928440](./看准网.assets/image-20230807161928440.png)

![image-20230807161936930](./看准网.assets/image-20230807161936930.png)

人家的没空格，

加一个去空格逻辑吧

![image-20230807163601644](./看准网.assets/image-20230807163601644.png)

注意这里要使用先判断它是什么

是空格还是换行，

![image-20230807164407714](./看准网.assets/image-20230807164407714.png)

这里使用了 

~~~
 e = e.replace(/[\r\n ]/g, ""); 
~~~

多测试几个

![image-20230807164614562](./看准网.assets/image-20230807164614562.png)

换一个接口也没问题。。

这个站，参数也是加密的

![image-20230807164914072](./看准网.assets/image-20230807164914072.png)

来看一下参数的生成逻辑吧

### 请求参数 

![image-20230807170127176](./看准网.assets/image-20230807170127176.png)

通过跟栈，这里可以发现

kiv和b的生成位置

kiv是有a得到的

![image-20230807170233094](./看准网.assets/image-20230807170233094.png)

a则是由这个函数生成的

而b是由t生成的

![image-20230807170515714](./看准网.assets/image-20230807170515714.png)

来自这个方法一看就是一个aes加密

来扣代码吧，

先将kiv扣下来，

![image-20230807170625720](./看准网.assets/image-20230807170625720.png)

一个随机的函数生成密钥

![image-20230807170731908](./看准网.assets/image-20230807170731908.png)

直接拿下来就行

和刚刚的解密如出一辙，

![image-20230807171306727](./看准网.assets/image-20230807171306727.png)

![image-20230807171318887](./看准网.assets/image-20230807171318887.png)

参数保持一致，发现没问题。

然后我们找一个请求参数模拟一下试试吧。

![image-20230807174917629](./看准网.assets/image-20230807174917629.png)

把整个流程搞通了



## 总结

如果要采集数据，还需要分析参数来源

但是非逆向内容，就不做深入研究了

此站，通过随机生成 aes的key 用其key对参数进行加密

返回的密文数据，也用key进行解密

在用户角度，请求和响应都是密文。

